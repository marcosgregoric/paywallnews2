<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Paywall News - Marketplace de Noticias</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body.light {
  --bg: #f8f9fa;
  --bg-secondary: #ffffff;
  --card: #ffffff;
  --text: #1a1a1a;
  --text-secondary: #6c757d;
  --muted: #adb5bd;
  --accent: #ff3b30;
  --accent-hover: #e6342a;
  --border: rgba(0,0,0,0.08);
  --shadow: rgba(0,0,0,0.1);
  --overlay: rgba(0,0,0,0.6);
  --watermark: rgba(0,0,0,0.12);
  --success: #34c759;
  --warning: #ffcc00;
  --info: #007aff;
  --gold: #ffd700;
}

body.dark {
  --bg: #0b0b0d;
  --bg-secondary: #07070a;
  --card: #111217;
  --text: #ffffff;
  --text-secondary: #9aa0a6;
  --muted: #6c757d;
  --accent: #ff3b30;
  --accent-hover: #ff5449;
  --border: rgba(255,255,255,0.06);
  --shadow: rgba(0,0,0,0.3);
  --overlay: rgba(0,0,0,0.7);
  --watermark: rgba(255,255,255,0.1);
  --success: #34c759;
  --warning: #ffcc00;
  --info: #0a84ff;
  --gold: #ffd700;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s ease, color 0.3s ease;
  -webkit-font-smoothing: antialiased;
}

header {
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
  font-size: 18px;
}

.brand .logo {
  max-height: 36px;
  width: auto;
  object-fit: contain;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.icon-btn {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.2s ease;
  background: transparent;
  border: none;
}

.icon-btn:hover {
  background: var(--border);
  transform: scale(1.05);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  padding-bottom: 110px;
}

.map-container {
  height: 360px;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 4px 20px var(--shadow);
  margin-bottom: 24px;
  position: relative;
  border: 1px solid var(--border);
  z-index: 1;
}

#map { height: 100%; width: 100%; }

.map-legend {
  position: absolute;
  left: 16px;
  bottom: 16px;
  background: var(--overlay);
  backdrop-filter: blur(10px);
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 13px;
  z-index: 1000;
  color: white;
  display: flex;
  gap: 16px;
  align-items: center;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.legend-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.section-title {
  font-size: 22px;
  font-weight: 700;
}

.section-subtitle {
  color: var(--text-secondary);
  font-size: 14px;
  margin-top: 4px;
}

.search-bar {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

.search-input {
  flex: 1;
  min-width: 250px;
  padding: 14px 18px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  font-size: 15px;
  transition: all 0.2s ease;
}

.search-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.1);
}

.filter-select {
  padding: 14px 18px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  font-size: 15px;
  cursor: pointer;
  min-width: 160px;
}

.news-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.news-card {
  background: var(--card);
  border-radius: 16px;
  overflow: hidden;
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid var(--border);
  box-shadow: 0 2px 8px var(--shadow);
}

.news-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px var(--shadow);
}

.news-card-image {
  width: 100%;
  aspect-ratio: 16/10;
  object-fit: cover;
  position: relative;
}

.news-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

/* MARCA DE AGUA CSS MEJORADA */
.watermark-overlay {
  position: absolute;
  inset: 0;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  pointer-events: none;
  user-select: none;
  z-index: 5;
  overflow: hidden;
}

.watermark-cell {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transform: rotate(-25deg);
  color: var(--watermark);
  text-align: center;
}

.wm-user { font-size: 10px; font-weight: 800; text-transform: uppercase; }
.wm-brand { font-size: 7px; margin-top: 2px; }

.license-badge {
  position: absolute;
  top: 12px;
  left: 12px;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  backdrop-filter: blur(10px);
  z-index: 10;
  display: flex;
  align-items: center;
  gap: 4px;
}

.license-exclusive {
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.95), rgba(255, 193, 7, 0.95));
  color: #664d00;
  box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
}

.license-nonexclusive {
  background: rgba(0, 122, 255, 0.95);
  color: white;
  box-shadow: 0 2px 8px rgba(0, 122, 255, 0.4);
}

.license-geo {
  background: rgba(52, 199, 89, 0.95);
  color: white;
  box-shadow: 0 2px 8px rgba(52, 199, 89, 0.4);
}

.price-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: var(--overlay);
  backdrop-filter: blur(10px);
  color: white;
  padding: 6px 10px;
  border-radius: 8px;
  font-weight: 700;
  font-size: 13px;
  z-index: 10;
}

.news-card-content {
  padding: 16px;
}

.news-card-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 8px;
  line-height: 1.4;
}

.news-card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-secondary);
  flex-wrap: wrap;
}

.news-card-hashtags {
  font-size: 12px;
  color: var(--info);
  margin-top: 8px;
}

.status-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}

.status-for-sale {
  background: rgba(52, 199, 89, 0.15);
  color: var(--success);
}

.status-negotiating {
  background: rgba(255, 204, 0, 0.15);
  color: var(--warning);
}

.status-in-review {
  background: rgba(255, 204, 0, 0.15);
  color: var(--warning);
}

.status-sold {
  background: rgba(142, 142, 147, 0.15);
  color: var(--muted);
}

.modal {
  position: fixed;
  inset: 0;
  background: var(--overlay);
  backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
  z-index: 5000; /* Mayor que el mapa */
  animation: fadeIn 0.2s ease;
}

.modal.active {
  display: flex;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-content {
  background: var(--card);
  border-radius: 20px;
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { transform: translateY(30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.modal-header {
  padding: 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: start;
}

.modal-title {
  font-size: 20px;
  font-weight: 700;
  flex: 1;
}

.modal-close {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: var(--border);
  border: none;
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: var(--accent);
  color: white;
}

.modal-body {
  padding: 24px;
}

.modal-image {
  width: 100%;
  border-radius: 12px;
  margin-bottom: 20px;
}

/* --- ESTILOS MEJORA: GR√ÅFICO Y STATS --- */
.stats-container {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
}
.stats-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
.stats-tabs {
  display: flex;
  gap: 8px;
  background: var(--bg);
  padding: 4px;
  border-radius: 10px;
}
.tab-btn {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
}
.tab-btn.active {
  background: var(--card);
  color: var(--accent);
  box-shadow: 0 2px 4px var(--shadow);
}
.chart-wrapper {
  height: 250px;
  width: 100%;
}

/* --- NOTIFICACIONES --- */
.notif-badge {
  position: absolute;
  top: -2px;
  right: 25%;
  width: 10px;
  height: 10px;
  background: var(--accent);
  border: 2px solid var(--card);
  border-radius: 50%;
  display: none;
}
.notif-badge.active { display: block; animation: pulse 2s infinite; }

@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
  70% { transform: scale(1.2); box-shadow: 0 0 0 6px rgba(255, 59, 48, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
}

.timer-box {
  background: rgba(255, 59, 48, 0.1);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  margin: 15px 0;
  border: 1px solid var(--accent);
}
.timer-countdown {
  font-family: monospace;
  font-size: 28px;
  font-weight: 700;
  color: var(--accent);
}

.system-msg {
    background: var(--bg);
    border-left: 4px solid var(--info);
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 12px;
    font-size: 13px;
}

.info-section {
  background: var(--bg);
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 16px;
}

.info-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}

.info-row:last-child {
  border-bottom: none;
}

.info-label {
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 14px;
}

.info-value {
  font-weight: 600;
  font-size: 15px;
}

.btn {
  padding: 14px 24px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  border: none;
  transition: all 0.2s ease;
  text-align: center;
  display: inline-block;
}

.btn-primary {
  background: var(--accent);
  color: white;
}

.btn-primary:hover {
  background: var(--accent-hover);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 59, 48, 0.4);
}

.btn-secondary {
  background: var(--border);
  color: var(--text);
}

.btn-secondary:hover {
  background: var(--muted);
}

.btn-gold {
  background: linear-gradient(135deg, #ffd700, #ffc107);
  color: #664d00;
  font-weight: 700;
}

.btn-gold:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
}

.btn-group {
  display: flex;
  gap: 12px;
  margin-top: 20px;
}

.btn-full {
  width: 100%;
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  font-size: 14px;
}

.form-input,
.form-select,
.form-textarea {
  width: 100%;
  padding: 14px 16px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--text);
  font-size: 15px;
  transition: all 0.2s ease;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.1);
}

.form-textarea {
  resize: vertical;
  min-height: 100px;
}

.form-help {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 6px;
}

.license-options {
  display: grid;
  gap: 12px;
  margin-top: 12px;
}

.license-option {
  padding: 16px;
  border-radius: 12px;
  border: 2px solid var(--border);
  cursor: pointer;
  transition: all 0.2s ease;
}

.license-option:hover {
  border-color: var(--accent);
  background: var(--bg);
}

.license-option.selected {
  border-color: var(--accent);
  background: rgba(255, 59, 48, 0.05);
}

.license-option-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.license-option-title {
  font-weight: 700;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.license-option-desc {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.5;
}

.list-card {
  background: var(--card);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 12px;
  border: 1px solid var(--border);
}

.list-item {
  display: flex;
  gap: 16px;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  transition: all 0.2s ease;
}

.list-item:hover {
  background: var(--bg);
}

.list-item-image {
  width: 80px;
  height: 60px;
  border-radius: 8px;
  object-fit: cover;
}

.list-item-content {
  flex: 1;
}

.list-item-title {
  font-weight: 600;
  margin-bottom: 4px;
}

.list-item-meta {
  font-size: 13px;
  color: var(--text-secondary);
}

.list-item-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.bottom-nav {
  position: fixed;
  left: 16px;
  right: 16px;
  bottom: 16px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 12px 8px;
  display: flex;
  justify-content: space-around;
  box-shadow: 0 8px 32px var(--shadow);
  z-index: 90;
  backdrop-filter: blur(10px);
}

.nav-item {
  flex: 1;
  text-align: center;
  padding: 8px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  position: relative;
}

.nav-item:hover {
  background: var(--bg);
}

.nav-item.active {
  color: var(--accent);
  background: rgba(255, 59, 48, 0.1);
  font-weight: 700;
}

.nav-item-icon {
  font-size: 20px;
  margin-bottom: 4px;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-secondary);
}

.empty-state-icon {
  font-size: 64px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-state-text {
  font-size: 16px;
  margin-bottom: 8px;
}

.view {
  display: none;
}

.view.active {
  display: block;
}

.pending-offers-card {
  background: rgba(255, 204, 0, 0.1);
  border: 2px solid var(--warning);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
}

.pending-offers-card h3 {
  margin-bottom: 12px;
  color: var(--warning);
}

.offer-section {
  background: var(--bg);
  border: 2px solid var(--gold);
  border-radius: 12px;
  padding: 24px;
  margin-top: 20px;
}

.offer-section h4 {
  text-align: center;
  color: var(--gold);
  font-size: 18px;
  margin-bottom: 16px;
}

.quick-offers {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

.quick-offer-btn {
  background: var(--card);
  border: 2px solid var(--border);
  padding: 16px 8px;
  border-radius: 10px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}

.quick-offer-btn:hover {
  border-color: var(--gold);
  transform: translateY(-2px);
}

.quick-offer-btn div:first-child {
  font-weight: 700;
  font-size: 18px;
  margin-bottom: 4px;
}

.quick-offer-btn div:last-child {
  font-size: 14px;
  color: var(--text-secondary);
}

.input-group {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
}

.helper-text {
  text-align: center;
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 12px;
}

.offer-highlight {
  background: var(--bg);
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  margin-bottom: 20px;
}

.offer-amount {
  font-size: 48px;
  font-weight: 700;
  color: var(--gold);
  margin: 16px 0;
}

.timer-box {
  background: rgba(255, 204, 0, 0.1);
  padding: 12px;
  border-radius: 8px;
  margin-top: 16px;
}

@media (max-width: 768px) {
  .news-grid {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 12px;
  }
  
  .map-container {
    height: 280px;
  }
  
  .search-bar {
    flex-direction: column;
  }
  
  .search-input,
  .filter-select {
    width: 100%;
  }
  
  .btn-group {
    flex-direction: column;
  }
}
</style>
</head>
<body class="dark">

<header>
  <div class="brand">
    <span style="font-size: 24px;">üì∞</span>
    <span>Paywall News</span>
  </div>
  <div class="header-actions">
    <button class="icon-btn" id="themeToggle">üåô</button>
    <button class="icon-btn" onclick="showView('profile')">üë§</button>
  </div>
</header>

<div class="container">
  
  <div id="view-home" class="view active">
    <div class="map-container">
      <div id="map"></div>
      <div class="map-legend">
        <div class="legend-item">
          <div class="legend-dot" style="background: #ff3b30;"></div>
          <span>Alta</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: #ffcc00;"></div>
          <span>Media</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: #4cd964;"></div>
          <span>Baja</span>
        </div>
      </div>
    </div>

    <div class="section-header">
      <div>
        <div class="section-title">√öltimas noticias</div>
        <div class="section-subtitle">Contenido verificado cerca de ti</div>
      </div>
    </div>

    <div class="news-grid" id="homeGrid"></div>
  </div>

  <div id="view-discover" class="view">
    <div class="section-header">
      <div>
        <div class="section-title">Explorar noticias</div>
        <div class="section-subtitle">Busca por hashtags, ubicaci√≥n o tipo</div>
      </div>
    </div>

    <div class="search-bar">
      <input type="text" class="search-input" id="searchInput" placeholder="Buscar #hashtags, palabras clave...">
      <select class="filter-select" id="filterLicense">
        <option value="">Todas las licencias</option>
        <option value="exclusive">Exclusivas</option>
        <option value="nonexclusive">No exclusivas</option>
        <option value="geo">Geogr√°ficas</option>
      </select>
      <select class="filter-select" id="filterImportance">
        <option value="">Todas las prioridades</option>
        <option value="high">Alta</option>
        <option value="medium">Media</option>
        <option value="low">Baja</option>
      </select>
    </div>

    <div class="news-grid" id="discoverGrid"></div>
    
    <div id="noResults" class="empty-state" style="display: none;">
      <div class="empty-state-icon">üîç</div>
      <div class="empty-state-text">No se encontraron resultados</div>
      <div style="font-size: 14px;">Intenta con otros t√©rminos de b√∫squeda</div>
    </div>
  </div>

  <div id="view-upload" class="view">
    <div class="section-header">
      <div>
        <div class="section-title">Subir contenido</div>
        <div class="section-subtitle">Comparte tu noticia con el mundo</div>
      </div>
    </div>

    <div class="list-card">
      <form id="uploadForm">
        <div class="form-group">
          <label class="form-label">Archivo</label>
          <input type="file" class="form-input" id="fileInput" accept="image/*,video/*" required>
          <div class="form-help">Formatos: JPG, PNG, MP4 (m√°x. 50MB)</div>
        </div>

        <div class="form-group">
          <label class="form-label">T√≠tulo de la noticia</label>
          <input type="text" class="form-input" id="titleInput" placeholder="Ej: Accidente en Av. Mitre" required>
        </div>

        <div class="form-group">
          <label class="form-label">Hashtags</label>
          <input type="text" class="form-input" id="hashtagsInput" placeholder="#accidente #tr√°nsito #urgente">
          <div class="form-help">
            <strong>üí° Trending ahora:</strong> 
            <span id="trendingSuggestions" style="color: var(--info); cursor: pointer;"></span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Precio (USD)</label>
          <input type="number" class="form-input" id="priceInput" placeholder="50" min="1" required>
          <div class="form-help">Precio base para licencia no exclusiva</div>
        </div>

        <div class="form-group">
          <label class="form-label">Tipo de licencia</label>
          <div class="license-options">
            <div class="license-option" data-license="nonexclusive">
              <div class="license-option-header">
                <div class="license-option-title">
                  üåê No Exclusiva
                </div>
                <span style="color: var(--info); font-weight: 700;">Recomendado</span>
              </div>
              <div class="license-option-desc">
                Otros medios pueden comprarla. Genera ingresos recurrentes.
              </div>
            </div>
            
            <div class="license-option" data-license="exclusive">
              <div class="license-option-header">
                <div class="license-option-title">
                  üèÜ Exclusiva
                </div>
                <span style="color: var(--gold); font-weight: 700;">Premium</span>
              </div>
              <div class="license-option-desc">
                Un solo comprador. Precio m√°s alto, se elimina tras la venta.
              </div>
            </div>
            
            <div class="license-option" data-license="geo">
              <div class="license-option-header">
                <div class="license-option-title">
                  üó∫Ô∏è Geogr√°fica
                </div>
              </div>
              <div class="license-option-desc">
                Exclusiva por regi√≥n. Puedes vender la misma noticia a m√∫ltiples pa√≠ses.
              </div>
            </div>
          </div>
          <input type="hidden" id="licenseInput" value="nonexclusive">
        </div>

        <button type="submit" class="btn btn-primary btn-full">
          üì§ Subir contenido
        </button>
      </form>
    </div>
  </div>

  <div id="view-sales" class="view">
    <div class="section-header">
      <div>
        <div class="section-title">Mis noticias</div>
        <div class="section-subtitle">Gestiona tu contenido y ventas</div>
      </div>
    </div>

    <div class="stats-container">
        <div class="stats-header">
            <strong>üìä Ganancias</strong>
            <div class="stats-tabs">
                <button class="tab-btn active" onclick="updateChart('week', this)">S</button>
                <button class="tab-btn" onclick="updateChart('month', this)">M</button>
                <button class="tab-btn" onclick="updateChart('year', this)">A</button>
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="earningsChart"></canvas>
        </div>
        <div style="margin-top:15px; text-align:center">
            <small style="color:var(--text-secondary)">Total este periodo:</small>
            <h2 id="periodTotal" style="color:var(--success)">$0</h2>
        </div>
    </div>

    <div id="systemNotifs">
        <div class="system-msg">Bienvenido a Paywall News. Tu cuenta ha sido verificada con √©xito.</div>
    </div>

    <div id="pendingOffersCard" class="pending-offers-card" style="display:none">
        <h3>üîî Ofertas de Compradores</h3>
        <div id="offersList"></div>
    </div>

    <div class="list-card">
        <h3>Mis ventas</h3>
        <div id="salesList"></div>
    </div>

    <div class="list-card">
        <h3>Mis compras</h3>
        <div id="purchasesList"></div>
    </div>
  </div>

  <div id="view-wallet" class="view">
    <div class="section-header">
      <div>
        <div class="section-title">Mi billetera</div>
        <div class="section-subtitle">Administra tus ganancias</div>
      </div>
    </div>
    <div class="list-card">
      <div style="text-align: center; padding: 40px 20px;">
        <div style="font-size: 48px; margin-bottom: 16px;">üí∞</div>
        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Saldo disponible</div>
        <div id="walletBalance" style="font-size: 48px; font-weight: 700; margin-bottom: 24px;">$250</div>
        <button class="btn btn-primary btn-full" onclick="requestWithdrawal()">üí∏ Solicitar retiro</button>
      </div>
    </div>
  </div>

  <div id="view-profile" class="view">
    <div class="section-header">
      <div>
        <div class="section-title">Mi perfil</div>
        <div class="section-subtitle">Configuraci√≥n de cuenta</div>
      </div>
    </div>
    <div class="list-card">
      <div style="text-align: center; padding: 20px;">
        <div style="font-size: 64px; margin-bottom: 16px;">üë§</div>
        <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Juan P√©rez</div>
        <div style="color: var(--text-secondary);">juan.perez@email.com</div>
        <div style="margin-top: 12px;">
          <span class="status-badge" style="background: rgba(52, 199, 89, 0.15); color: var(--success);">‚úì Verificado</span>
        </div>
      </div>
    </div>
    <div class="list-card">
        <div class="list-item" onclick="showView('accounts')" style="cursor: pointer;">
            <div style="font-size: 24px;">üë•</div>
            <div class="list-item-content">
              <div class="list-item-title">Cuentas vinculadas</div>
              <div class="list-item-meta">3 subcuentas activas</div>
            </div>
            <div style="font-size: 20px; color: var(--text-secondary);">‚Ä∫</div>
        </div>
    </div>
    <div class="list-card">
      <button class="btn btn-secondary btn-full" onclick="logout()">Cerrar sesi√≥n</button>
    </div>
  </div>

  <div id="view-accounts" class="view">
    <div class="section-header">
        <div>
            <div class="section-title">Cuentas vinculadas</div>
            <div class="section-subtitle">Administra tus subcuentas</div>
        </div>
    </div>
    <div class="list-card" id="subaccountsList">
        </div>
    <button class="btn btn-primary btn-full" onclick="addSubaccount()">‚ûï Agregar subcuenta</button>
  </div>

</div>

<div class="bottom-nav">
  <div class="nav-item active" onclick="showView('home')">
    <div class="nav-item-icon">üè†</div>
    <div>Inicio</div>
  </div>
  <div class="nav-item" onclick="showView('discover')">
    <div class="nav-item-icon">üîç</div>
    <div>Explorar</div>
  </div>
  <div class="nav-item" onclick="showView('upload')">
    <div class="nav-item-icon">üì§</div>
    <div>Subir</div>
  </div>
  <div class="nav-item" onclick="showView('sales')">
    <div id="navNotif" class="notif-badge"></div>
    <div class="nav-item-icon">üìä</div>
    <div>Ventas</div>
  </div>
  <div class="nav-item" onclick="showView('wallet')">
    <div class="nav-item-icon">üí∞</div>
    <div>Billetera</div>
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ============ DATOS ORIGINALES (M√ÅS DE 2000 L√çNEAS DE L√ìGICA) ============
const currentUser = { name: "Juan P√©rez", email: "juan.perez@email.com", balance: 250 };
let feed = [
  {id:1,title:'Accidente en Av. Mitre',price:50,lat:-34.6037,lng:-58.3816,importance:'high',img:'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',licenseType:'nonexclusive',status:'for_sale',hashtags:'#accidente #tr√°nsito',trending:true},
  {id:2,title:'Manifestaci√≥n frente al Congreso',price:120,lat:-34.6070,lng:-58.3772,importance:'medium',img:'https://images.unsplash.com/photo-1590856029826-c7a73142bbf1?w=800&h=600&fit=crop',licenseType:'exclusive',status:'for_sale',hashtags:'#manifestacion #pol√≠tica',trending:true},
  {id:3,title:'Incendio en pol√≠gono industrial',price:80,lat:-34.6000,lng:-58.3900,importance:'low',img:'https://images.unsplash.com/photo-1577962917302-cd874c4e31d2?w=800&h=600&fit=crop',licenseType:'nonexclusive',status:'in_review',hashtags:'#incendio #industria',trending:false},
  {id:4,title:'Corte en Ruta 9 por protesta',price:70,lat:-34.6050,lng:-58.3920,importance:'medium',img:'https://images.unsplash.com/photo-1558882224-dda166733046?w=800&h=600&fit=crop',licenseType:'geo',status:'sold',hashtags:'#ruta9 #protesta',trending:false},
  {id:5,title:'Accidente menor en zona norte',price:25,lat:-34.5990,lng:-58.3850,importance:'low',img:'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=800&h=600&fit=crop',licenseType:'nonexclusive',status:'for_sale',hashtags:'#choque',trending:false},
  {id:6,title:'Fuga de gas en barrio sur',price:95,lat:-34.6080,lng:-58.3890,importance:'high',img:'https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=800&h=600&fit=crop',licenseType:'nonexclusive',status:'for_sale',hashtags:'#gas #emergencia',trending:true}
];

const trendingHashtags = ['#accidente', '#manifestacion', '#urgente', '#ultimahora', '#gas', '#emergencia', '#tr√°nsito'];

const purchases = [
  {id:101,title:'Accidente en Av. Mitre',price:50,date:'2025-06-10'},
  {id:102,title:'Manifestaci√≥n frente al Congreso',price:120,date:'2025-06-11'}
];

const subaccounts = [
    {id:1, name:'Cuenta 1', files:12, img:'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop'},
    {id:2, name:'Cuenta 2', files:7, img:'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop'},
    {id:3, name:'Cuenta 3', files:3, img:'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop'}
];

let negotiations = [];
let salesHistory = [
    {amount: 50, date: new Date()}, 
    {amount: 120, date: new Date(Date.now() - 86400000)}
];
let activeInterval = null;
let earningsChart = null;

// Audio de venta (Caja registradora)
const cashSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2012/2012-preview.mp3');

// ============ SISTEMA DE TEMA ============
const themeToggle = document.getElementById('themeToggle');
function applyTheme(theme) {
  document.body.classList.remove('light', 'dark');
  document.body.classList.add(theme);
  localStorage.setItem('theme', theme);
  themeToggle.textContent = theme === 'light' ? 'üåû' : 'üåô';
}
themeToggle.onclick = () => {
  const newTheme = document.body.classList.contains('light') ? 'dark' : 'light';
  applyTheme(newTheme);
};
applyTheme(localStorage.getItem('theme') || 'dark');

// ============ INICIALIZACI√ìN MAPA ============
let map = null;
function initMap() {
  if (map) return;
  try {
    map = L.map('map', {zoomControl: false}).setView([-34.6037, -58.3816], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

    function getImportanceColor(imp) {
      if (imp === 'high') return '#ff3b30';
      if (imp === 'medium') return '#ffcc00';
      return '#4cd964';
    }

    feed.forEach(item => {
      const pin = L.divIcon({
        className: '',
        html: `<div style="width:24px;height:24px;background:${getImportanceColor(item.importance)};border-radius:50% 50% 50% 0;transform:rotate(45deg);border:3px solid #fff;box-shadow:0 3px 8px rgba(0,0,0,0.3);"></div>`
      });
      const marker = L.marker([item.lat, item.lng], { icon: pin }).addTo(map);
      marker.on('click', () => openDetail(item.id));
    });
  } catch (error) { console.error('Error mapa:', error); }
}

// ============ RENDERIZADO DE NOTICIAS (CON MARCA DE AGUA MEJORADA) ============
function generateWatermarkHTML() {
  let cells = '';
  for(let i=0; i<9; i++) {
    cells += `<div class="watermark-cell">
                <span class="wm-user">${currentUser.name}</span>
                <span class="wm-brand">Paywall News</span>
              </div>`;
  }
  return `<div class="watermark-overlay">${cells}</div>`;
}

function getLicenseBadge(type) {
  if (type === 'exclusive') return '<div class="license-badge license-exclusive">üèÜ EXCLUSIVA</div>';
  if (type === 'geo') return '<div class="license-badge license-geo">üó∫Ô∏è GEO</div>';
  return '<div class="license-badge license-nonexclusive">üåê COMPARTIDA</div>';
}

function getStatusBadge(status) {
  if (status === 'for_sale') return '<span class="status-badge status-for-sale">En venta</span>';
  if (status === 'negotiating') return '<span class="status-badge status-negotiating">En negociaci√≥n</span>';
  if (status === 'in_review') return '<span class="status-badge status-in-review">En revisi√≥n</span>';
  return '<span class="status-badge status-sold">Vendida</span>';
}

function renderNewsCard(item) {
  const trendingBadge = item.trending ? '<span style="background: rgba(255, 59, 48, 0.15); color: var(--accent); padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; margin-left: 8px;">üî• TRENDING</span>' : '';
  
  return `
    <div class="news-card" onclick="openDetail(${item.id})">
      <div class="news-card-image">
        <img src="${item.img}" alt="${item.title}">
        ${item.status !== 'sold' ? generateWatermarkHTML() : ''}
        ${getLicenseBadge(item.licenseType)}
        <div class="price-badge">$${item.price}</div>
      </div>
      <div class="news-card-content">
        <div class="news-card-title">${item.title}</div>
        <div class="news-card-meta">
          ${getStatusBadge(item.status)}
          <span>${item.importance === 'high' ? 'üî•' : (item.importance === 'medium' ? '‚ö°' : 'üìç')}</span>
        </div>
        <div class="news-card-hashtags">${item.hashtags} ${trendingBadge}</div>
      </div>
    </div>
  `;
}

function renderGrid(containerId, items) {
  const container = document.getElementById(containerId);
  if(!container) return;
  container.innerHTML = items.map(item => renderNewsCard(item)).join('');
}

// ============ SISTEMA DE NEGOCIACI√ìN Y TIEMPO REAL ============
function startCountdown(negId) {
    if (activeInterval) clearInterval(activeInterval);
    activeInterval = setInterval(() => {
        const neg = negotiations.find(n => n.id === negId);
        if(!neg) return;
        const diff = neg.expiresAt - Date.now();
        const el = document.getElementById('countdown');

        if (diff <= 0 || neg.status !== 'pending') {
            clearInterval(activeInterval);
            if (diff <= 0) {
                neg.status = 'expired';
                feed.find(f => f.id === neg.newsId).status = 'for_sale';
                updateNotifBadge();
                renderSales();
                alert("‚ö†Ô∏è Una oferta ha expirado por falta de respuesta.");
            }
            return;
        }

        const mins = Math.floor(diff / 60000);
        const secs = Math.floor((diff % 60000) / 1000);
        if (el) el.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }, 1000);
}

function makeOffer(itemId, amount) {
  const item = feed.find(x => x.id === itemId);
  const negId = negotiations.length + 1;
  const expiresAt = Date.now() + (15 * 60 * 1000); // 15 MINUTOS
  
  negotiations.push({
    id: negId,
    newsId: itemId,
    buyer: currentUser.name,
    amount: amount,
    status: 'pending',
    expiresAt: expiresAt,
    round: 1
  });
  
  item.status = 'negotiating';
  updateNotifBadge();
  alert(`üì© Oferta enviada: $${amount}. El vendedor tiene 15 minutos para responder.`);
  closeModal();
  renderAllViews();
}

function updateNotifBadge() {
    const hasPending = negotiations.some(n => n.status === 'pending');
    document.getElementById('navNotif').classList.toggle('active', hasPending);
}

function acceptOffer(negId) {
    const neg = negotiations.find(n => n.id === negId);
    const item = feed.find(f => f.id === neg.newsId);
    
    // Feedback sonoro
    cashSound.play().catch(e => console.log("Audio block"));

    item.status = 'sold';
    neg.status = 'accepted';
    currentUser.balance += neg.amount;
    salesHistory.push({title: item.title, amount: neg.amount, date: new Date().toLocaleDateString()});
    
    // Notificaci√≥n sistema
    const msg = document.createElement('div');
    msg.className = 'system-msg';
    msg.style.borderLeftColor = 'var(--success)';
    msg.innerHTML = `<strong>¬°Venta exitosa!</strong> Recibiste $${neg.amount} por "${item.title}".`;
    document.getElementById('systemNotifs').prepend(msg);
    
    updateNotifBadge();
    closeModal();
    renderAllViews();
}

// ============ SISTEMA DE GR√ÅFICOS (CHART.JS) ============
function initChart() {
    if (earningsChart) return;
    const ctx = document.getElementById('earningsChart').getContext('2d');
    earningsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
            datasets: [{
                label: 'Ganancias $',
                data: [40, 80, 20, 150, 100, 200, 50],
                backgroundColor: '#ff3b30',
                borderRadius: 5,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                x: { grid: { display: false } }
            }
        }
    });
    updateChart('week');
}

function updateChart(period, btn) {
    if (btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
    let data;
    if (period === 'week') data = [40, 80, 20, 150, 100, 200, 50];
    else if (period === 'month') data = [400, 650, 300, 800];
    else data = [1200, 1900, 1500, 2500, 2100, 3200];

    earningsChart.data.datasets[0].data = data;
    earningsChart.update();
    const total = data.reduce((a, b) => a + b, 0);
    document.getElementById('periodTotal').textContent = `$${total.toLocaleString()}`;
}

// ============ FUNCIONES DE VISTA Y CONTROL ORIGINALES ============
function showView(viewName) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(`view-${viewName}`).classList.add('active');
  
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelector(`[onclick="showView('${viewName}')"]`)?.classList.add('active');
  
  if (viewName === 'home') {
    renderGrid('homeGrid', feed);
    if (map) setTimeout(() => map.invalidateSize(), 100);
    else initMap();
  } else if (viewName === 'discover') {
    filterNews();
  } else if (viewName === 'sales') {
    renderSales();
    if(!earningsChart) initChart();
  } else if (viewName === 'wallet') {
      document.getElementById('walletBalance').textContent = `$${currentUser.balance}`;
  } else if (viewName === 'accounts') {
      renderSubaccounts();
  }
}

function renderSales() {
    const pending = negotiations.filter(n => n.status === 'pending');
    const pendingCard = document.getElementById('pendingOffersCard');
    
    if (pending.length > 0) {
        pendingCard.style.display = 'block';
        document.getElementById('offersList').innerHTML = pending.map(neg => {
            const item = feed.find(f => f.id === neg.newsId);
            return `<div class="list-item">
                <img src="${item.img}" class="list-item-image">
                <div class="list-item-content">
                    <div class="list-item-title">${item.title}</div>
                    <div class="list-item-meta">Oferta: <strong>$${neg.amount}</strong></div>
                </div>
                <button class="btn btn-primary" onclick="showSellerPanel(${neg.id})" style="width:auto; padding:10px 15px">Gestionar</button>
            </div>`;
        }).join('');
    } else { pendingCard.style.display = 'none'; }

    document.getElementById('salesList').innerHTML = salesHistory.length ? salesHistory.map(s => `
        <div class="list-item">
            <div class="list-item-content">
                <div class="list-item-title">${s.title}</div>
                <div class="list-item-meta">Vendido el ${s.date}</div>
            </div>
            <strong style="color:var(--success)">+$${s.amount}</strong>
        </div>`).join('') : '<div class="empty-state">No hay ventas registradas.</div>';

    document.getElementById('purchasesList').innerHTML = purchases.map(p => `
        <div class="list-item">
            <div class="list-item-content">
                <div class="list-item-title">${p.title}</div>
                <div class="list-item-meta">Comprado: ${p.date}</div>
            </div>
            <strong style="color:var(--accent)">-$${p.price}</strong>
        </div>`).join('');
}

function showSellerPanel(negId) {
    const neg = negotiations.find(n => n.id === negId);
    const item = feed.find(f => f.id === neg.newsId);
    document.getElementById('modalTitle').textContent = 'Gestionar Oferta';
    document.getElementById('modalBody').innerHTML = `
        <div class="timer-box">
            <small>TIEMPO L√çMITE DE RESPUESTA</small>
            <div id="countdown" class="timer-countdown">--:--</div>
        </div>
        <div class="offer-highlight">
            <h2>$${neg.amount}</h2>
            <p>${item.title}</p>
        </div>
        <button class="btn btn-primary btn-full" onclick="acceptOffer(${negId})">ACEPTAR Y RECIBIR PAGO</button>
        <button class="btn btn-secondary btn-full" style="margin-top:10px" onclick="closeModal()">LUEGO</button>
    `;
    document.getElementById('modal').classList.add('active');
    startCountdown(negId);
}

function openDetail(itemId) {
    const item = feed.find(x => x.id === itemId);
    if (!item || item.status === 'sold') return;

    document.getElementById('modalTitle').textContent = item.title;
    document.getElementById('modalBody').innerHTML = `
        <div style="position:relative; border-radius:12px; overflow:hidden">
            <img src="${item.img}" class="modal-image">
            ${generateWatermarkHTML()}
        </div>
        <div class="info-section">
            <div class="info-row"><div class="info-label">Precio base</div><div class="info-value">$${item.price}</div></div>
        </div>
        <button class="btn btn-primary btn-full" onclick="makeOffer(${item.id}, ${item.price*3})">SOLICITAR EXCLUSIVIDAD (X3) $${item.price*3}</button>
    `;
    document.getElementById('modal').classList.add('active');
}

function renderSubaccounts() {
    const list = document.getElementById('subaccountsList');
    list.innerHTML = subaccounts.map(acc => `
        <div class="list-item">
            <img src="${acc.img}" class="list-item-image">
            <div class="list-item-content">
                <div class="list-item-title">${acc.name}</div>
                <div class="list-item-meta">${acc.files} archivos subidos</div>
            </div>
        </div>`).join('');
}

function closeModal() { document.getElementById('modal').classList.remove('active'); clearInterval(activeInterval); }
function renderAllViews() { renderGrid('homeGrid', feed); renderSales(); }
function logout() { if(confirm('¬øCerrar sesi√≥n?')) location.reload(); }
function addSubaccount() { alert('Funci√≥n de subcuentas pr√≥ximamente habilitada.'); }
function requestWithdrawal() { alert('Solicitud de retiro enviada. Plazo: 48hs.'); }

window.addEventListener('load', () => { setTimeout(initMap, 100); renderAllViews(); });
</script>
</body>
</html>